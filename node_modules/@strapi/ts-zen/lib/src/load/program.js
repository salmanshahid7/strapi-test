"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.createInlineProgram = void 0;
const typescript_1 = __importDefault(require("typescript"));
const path_1 = __importDefault(require("path"));
const constants_1 = require("../constants");
const options_1 = require("../load/options");
const FILENAME_RE = new RegExp(constants_1.FILENAME);
const createInlineProgram = (code, customCompilerOptions, ignoreProjectOptions, baseUrl) => {
    let sourceFile;
    const filePath = path_1.default.resolve(baseUrl ?? process.cwd(), constants_1.FILENAME);
    const getSourceFile = (filename, languageVersion, ...args) => {
        if (!FILENAME_RE.test(filename)) {
            return compilerHost.getSourceFile(filename, languageVersion, ...args);
        }
        if (sourceFile === undefined) {
            sourceFile = typescript_1.default.createSourceFile(filePath, code, languageVersion);
        }
        return sourceFile;
    };
    const options = (0, options_1.getOptions)(customCompilerOptions, ignoreProjectOptions);
    const compilerHost = typescript_1.default.createCompilerHost(options);
    const customCompilerHost = { ...compilerHost, getSourceFile };
    const program = typescript_1.default.createProgram([filePath], options, customCompilerHost);
    return { program, sourceFile };
};
exports.createInlineProgram = createInlineProgram;
//# sourceMappingURL=program.js.map